<!DOCTYPE html>
<html>
<head>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Wood Volume Calculator</title>
<link rel="manifest" href="manifest.json">

<style>
body{
  font-family: Arial;
  text-align:center;
  padding:20px;
}

h2{
  margin-bottom:15px;
}

input{
  padding:15px;
  margin:8px;
  width:85%;
  font-size:18px;
}

button{
  padding:15px 20px;
  margin:8px;
  font-size:18px;
  cursor:pointer;
}

#result{
  font-size:26px;
  margin-top:15px;
  font-weight:bold;
  color:green;
}

#status{
  font-size:18px;
  color:#555;
  margin-top:10px;
}
</style>
</head>

<body>

<h2>Wood Volume Calculator</h2>

<input id="a" placeholder="Length (mm)">
<input id="b" placeholder="Width (mm)">
<input id="c" placeholder="Height (mm)">

<br>

<button onclick="startVoice()">ðŸŽ¤ Speak Numbers</button>
<button onclick="calc()">Calculate</button>

<div id="status"></div>
<div id="result">Result: --</div>

<script>

const aEl = document.getElementById('a');
const bEl = document.getElementById('b');
const cEl = document.getElementById('c');
const resultEl = document.getElementById('result');
const statusEl = document.getElementById('status');

function beep(){
  const ctx = new AudioContext();
  const osc = ctx.createOscillator();
  osc.type = "sine";
  osc.frequency.value = 800;
  osc.connect(ctx.destination);
  osc.start();
  osc.stop(ctx.currentTime + 0.15);
}

function speak(text){
  const msg = new SpeechSynthesisUtterance(text);
  msg.rate = 1;
  speechSynthesis.speak(msg);
}

function calc(){
  let A = +aEl.value || 0;
  let B = +bEl.value || 0;
  let C = +cEl.value || 0;

  let res = ((A/100)*(B/100)*(C/100))/16;
  let r = res.toFixed(3);

  resultEl.innerText = "Result: " + r;

  speak("Result " + r);
}

function startVoice(){

  let SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;

  let attempts = 0;
  const maxAttempts = 3;

  function listen(){

    statusEl.innerText = "ðŸŽ¤ Listening...";
    beep();

    let rec = new SpeechRecognition();
    rec.lang = "ml-IN";
    rec.continuous = false;
    rec.interimResults = false;

    rec.start();

    rec.onresult = (e)=>{
      let text = e.results[0][0].transcript;
      console.log("Heard:", text);

      let nums = text.match(/\d+/g);

      if(nums && nums.length >= 3){
        aEl.value = nums[0];
        bEl.value = nums[1];
        cEl.value = nums[2];

        statusEl.innerText = "âœ… Got numbers!";
        calc();
        rec.stop();
      } else {
        retry();
      }
    };

    rec.onspeechend = ()=>{
      rec.stop();
    };

    rec.onerror = ()=>{
      retry();
    };
  }

  function retry(){
    attempts++;

    if(attempts < maxAttempts){
      statusEl.innerText = "âš ï¸ Try again... ("+attempts+")";
      listen();
    } else {
      statusEl.innerText = "âŒ Couldn't detect. Tap mic again.";
      speak("Please try again");
    }
  }

  listen();
}

// service worker
if('serviceWorker' in navigator){
  navigator.serviceWorker.register('sw.js');
}

</script>

</body>
</html>
